# 3. Стиль API, політика кодів та формат помилок

Date: 2025-12-18
Status: Accepted

## Context
Для забезпечення передбачуваної та стабільної взаємодії між клієнтською частиною (Frontend) та сервером, необхідно затвердити єдиний стиль проектування API. Хаотичне використання HTTP-методів, різнобій у статус-кодах або повернення помилок у неструктурованому форматі ускладнює розробку, тестування та інтеграцію.

## Decision
Ми приймаємо стандарт **RESTful API** та зобов'язуємось суворо дотримуватися специфікації **OpenAPI 3.0**, яка описана у файлі `docs/api/openapi.yaml`.

### 1. Стиль API (REST Principles)
Всі ендпоїнти будуються навколо **Ресурсів** (іменники), а не дій (дієслова).

* ✅ **Правильно:**
  * `POST /expenses` — створити витрату
  * `GET /expenses` — отримати список
  * `GET /expenses/{id}` — отримати одну витрату
* ❌ **Неправильно:**
  * `POST /createExpense` (RPC стиль)
  * `GET /getExpensesList`
  * `GET /expenses?action=delete&id=123`

### 2. Політика HTTP статусів (Status Codes)
Сервер повинен використовувати семантично правильні HTTP коди. Заборонено повертати `200 OK`, якщо операція завершилася помилкою.

#### Успішні відповіді
* **200 OK:** Запит виконано успішно, сервер повертає дані (для GET, PUT).
* **201 Created:** Ресурс успішно створено (для POST).
* **204 No Content:** Запит виконано успішно, тіло відповіді відсутнє (для DELETE).

#### Помилки клієнта
* **400 Bad Request:** Помилка валідації даних (невірний JSON, відсутні обов'язкові поля, некоректні типи даних).
* **401 Unauthorized:** Користувач не надав токен автентифікації або токен невірний.
* **403 Forbidden:** Користувач авторизований, але не має прав доступу до цього ресурсу.
* **404 Not Found:** Ресурс за вказаним ідентифікатором не знайдено.

#### Помилки сервера
* **500 Internal Server Error:** Непередбачена помилка на боці сервера (збій БД, помилка в коді).

### 3. Уніфікований формат помилки (Error Model)
У разі виникнення будь-якої помилки (4xx або 5xx), API повинно повертати JSON об'єкт зі стандартизованою структурою `ErrorResponse`. Це дозволяє фронтенду використовувати єдиний механізм для відображення помилок.

### 4. Відповідність OpenAPI (Compliance)
* **Contract First / Strict Contract:** Реалізація коду (Controller, DTO) не повинна відхилятися від контракту `openapi.yaml`.
* Будь-які зміни в API (додавання полів, зміна шляхів) спочатку документуються в `openapi.yaml`, а потім імплементуються в коді.

## Consequences
* **Позитивні:**
    * Передбачуваність поведінки API для фронтенд-розробки.
    * Можливість автоматичної генерації клієнтського коду або документації.
    * Спрощена обробка помилок на клієнті (єдиний формат).
* **Негативні:**
    * Необхідність писати додатковий код (middleware) для форматування помилок.
    * Потреба у дисципліні для підтримки актуальності файлу OpenAPI.